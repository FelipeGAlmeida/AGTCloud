<app-header></app-header>
<div class="wrapper-content m-0">

  <!-- Message -->
  <p-messages [(value)]="msgs" [style]="{'width':'100vw','margin':'0','margin-top':'5px', 'padding':'0'}" [closable]="false"
    key="message"></p-messages>

    <!-- Config. do sensor -->
    <div class="row row-eq-height container-fluid m-0 p-1 justify-content-center">
      <div class="col-md-6 p-1">
        <div class="h-100 p-2 box-shadow" style="background-color: #505050;">
          <div class="row">
            <p class="mx-auto font-weight-bold box-shadow" style="background-color: #007AD9; border-radius: 10px; color: white; width: 18em; text-align: center">Configurações
                do sensor</p>
          </div>
          <div class="row">
            <div class="col">
              <p class="my-1 mx-2">Selecione um local:</p>
            </div>
            <div class="col">
              <p-dropdown class="ui-g-12" [options]="devices" [(ngModel)]="selectedDevice" placeholder="Locais disponíveis"
              (onChange)="getDeviceSensors($event)"></p-dropdown>
            </div>
          </div>
          <div *ngIf="sensorNames.length>0" class="row">
            <div class="col">
              <p class="my-1 mx-2">Selecione um sensor:</p>
            </div>
            <div class="col">
                <div *ngIf="sensorNames.length>0" class="ui-g-12"><p-checkbox name="group1" value={{sensorNames[0].value}} label={{dictionary[sensorNames[0].value]}} [(ngModel)]="selectedSensor" (onChange)="prepareSensorData($event)"></p-checkbox>&nbsp;<span style="color: #00F">●</span></div>
                <div *ngIf="sensorNames.length>1" class="ui-g-12"><p-checkbox name="group1" value={{sensorNames[1].value}}} label={{dictionary[sensorNames[1].value]}} [(ngModel)]="selectedSensor" (onChange)="prepareSensorData($event)"></p-checkbox>&nbsp;<span style="color: #0F0">●</span></div>
                <div *ngIf="sensorNames.length>2" class="ui-g-12"><p-checkbox name="group1" value={{sensorNames[2].value}}} label={{dictionary[sensorNames[2].value]}} [(ngModel)]="selectedSensor" (onChange)="prepareSensorData($event)"></p-checkbox>&nbsp;<span style="color: #F00">●</span></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Filtros de dados -->
      <div *ngIf="selectedSensor && selectedSensor.length>0" class="col-md-6 p-1">
        <div class="h-100 p-2 box-shadow" style="background-color: #505050;">
          <div class="row">
              <p class="mx-auto font-weight-bold box-shadow" style="background-color: #007AD9; border-radius: 10px; color: white; width: 18em; text-align: center">Configurações
                  de data e hora</p>
          </div>
          <div class="row">
              <div class="col">
                <p class="mx-2 my-1">Data inicial:</p>
              </div>
              <div class="col">
                <p-calendar class=" my-1" [(ngModel)]="iDate" showTime="true" dateFormat="mm.dd.yy" hourFormat="24"
                  (onClose)="setCalendarFilter($event)"></p-calendar>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <p class="mx-2 my-1">Data final:</p>
              </div>
              <div class="col">
                <p-calendar class="my-1" [(ngModel)]="eDate" showTime="true" dateFormat="mm.dd.yy" hourFormat="24"
                  (onClose)="setCalendarFilter($event)"></p-calendar>
              </div>
          </div>
          <div class="row">
            <div class="col my-1">
              <p class="d-inline mx-2">Últimos(as):</p>
              <p-inputMask class="d-inline" [(ngModel)]="tMode" mask="9?99" [style]="{'width':'3em'}" (keyup.enter)="setLastFilter($event)"></p-inputMask>
            </div>
            <div class="col my-1">
              <div class="ui-g-12 p-0"><p-radioButton name="group1" value="mn" label="Minuto(s)" [(ngModel)]="sMode" (onClick)="setLastFilter($event)"></p-radioButton></div>
              <div class="ui-g-12 p-0"><p-radioButton name="group1" value="hh" label="Hora(s)" [(ngModel)]="sMode" (onClick)="setLastFilter($event)"></p-radioButton></div>
              <div class="ui-g-12 p-0"><p-radioButton name="group1" value="dd" label="Dia(s)" [(ngModel)]="sMode" (onClick)="setLastFilter($event)"></p-radioButton></div>
              <div class="ui-g-12 p-0"><p-radioButton name="group1" value="mm" label="Mês(s)" [(ngModel)]="sMode" (onClick)="setLastFilter($event)"></p-radioButton></div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <!-- Gráfico e Lista -->
  <div class="row row-eq-height container-fluid m-0 px-1 pb-1 justify-content-center" [hidden]="!selectedSensor || !(selectedSensor.toString().length>0)">
    <div class="col-xl-7 p-0">
      <div class="p-1 m-1 box-shadow" style="background-color: #505050;">
        <div class="float-right">
          <p class="float-left mr-1">Tempo Real:</p>
          <p-inputSwitch class="mt-3" [(ngModel)]="realtime" (onChange)="enableRT()"></p-inputSwitch>
        </div>
        <p class="text-center font-weight-bold">Gráfico</p>
        <canvas baseChart [datasets]="chartData"
                          [labels]="chartLabels"
                          [legend]="chartLegend"
                          [chartType]="chartType"
                          [options]="options">
        </canvas>
      </div>
    </div>
    
    <div class="col-xl-5 p-0 ext-height">
      <div id="parent" class="h-100 p-1 m-1 box-shadow" style="background-color: #505050;">
        <p class="text-center font-weight-bold my-1">Lista dos dados coletados</p>
        <div id="child" style="overflow-y: scroll;">
          <table *ngIf="selectedSensor && selectedSensor.toString().length>0" class="table table-striped table-borderless">
            <thead>
              <tr>
                <th class="text-center">Data da coleta</th>
                <th *ngIf="selectedSensor && selectedSensor.toString().includes('sns_humidity')" class="text-center">Umidade</th> 
                <th *ngIf="selectedSensor && selectedSensor.toString().includes('sns_atmosphericPressure')" class="text-center">Pressão</th> 
                <th *ngIf="selectedSensor && selectedSensor.toString().includes('sns_temperature')" class="text-center">Temperatura</th> 
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let value of selectedValues.slice().reverse(); let i=index">
                <td *ngIf="selectedSensor && selectedSensor.toString().length>0" class="p-0 pl-1 py-1 text-center">{{dataLables[selectedValues.length-i-1]}}</td>
                <td *ngIf="humidityValues.length>0" class="p-0 pr-1 py-1 text-center">{{humidityValues[selectedValues.length-i-1]}}</td>
                <td *ngIf="pressureValues.length>0" class="p-0 pr-1 py-1 text-center">{{pressureValues[selectedValues.length-i-1]}}</td>
                <td *ngIf="temperatureValues.length>0" class="p-0 pr-1 py-1 text-center">{{temperatureValues[selectedValues.length-i-1]}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading -->
<div class="loading-indicator">
  <mat-progress-spinner mode="indeterminate" color="primary"></mat-progress-spinner>
</div>